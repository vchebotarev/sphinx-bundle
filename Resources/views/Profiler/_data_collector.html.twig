{% extends 'WebProfilerBundle:Profiler:layout.html.twig' %}

{% block toolbar %}
    {% set icon %}
        <img alt="Sphinx" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAcCAYAAAB2+A+pAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wITDhcW7BmzhgAABOVJREFUSMftVstrnFUU/51z7/eYmcxMHk2rxjbWpNJqrCBUxQdFUJAiKIgL3ys3+gdocVEQF4oLXRbdCKJoLWjFYny0KCrSQi2ltkgTX7VJGzOZmWTm+2bmu4/joh1tYytNKXWhv9V37j33/s4933kB/xLoIurKxSKmRd9yDgJaRE7nYwidRe6SyGmrfaVCsRxoXVTMOUU6JiY4scZ52zaZXWim6bzzvtI9wszkvT+nAQSATyPz3Y1QB1cWiz2jWgcjmvkGpfUoMV9OxCUijogIHt4CSOBlxphswlm7t2OyI7V6/RCAKgAopdg5J4sNoDMFGhro670xCsMxZnWzUmoMxMsYUiBmDe/gWgnEWZCcspEYFISgIPaidNM7O+O8+8ZYt3u2OrfLOzcNAFprstb+SU7L+vo2EauRQAerleLrtFbXEqgfQExEzMQQAry186o82MitXjekegfBuR4BiKTVFPP7UeocPUKuMQfoCOKsA2jeeLuv0+68NVuv7hDn6/k4RtpuAwB0FOeeiKPoPvGeiCjoeoGZYUx2POlkOz3wNVj/etUjzzxXHF1/JYWxUBiRgEiyNqTVoPSXH+aPbXv1TZqa2BTli1c7a8qh0nerPK9cJr3Ts9XqZ11SANDNZvPdOAzvB8ACOEDanSzbmabpO5m1hxg01TamM/bCuzp39bVDXOqF67SJrBEAEGbR/ZdRFOZ1q3/oi873e1/pAT2Wj+LNIFIQ5Im5tDi42Fm7o9FsbmFmLd4TBD0kUJkxe5MkmWgkzdSYjJhYfJY1xXlABER00jUiJM7Am7Y3UGkzMz+dmJl5frY6d6cx5lsSiryXbHFMqcwaaWWtvUopisJwIwRQWl0X6OCmOIy+S1utCgDPV6wW06yHpVWjm4gIEAGIiESEgpDqteoRXe7fXP/yfQDwWZYdy4wZB8EpxVNJmk6eHtnq+rVrMTNbcUmafhUGYTUI9I1E1BNoPayUeiCOoxNBEEzN7vk8yW95+4D9bWJNvlAcBavgVJJK2mr/PPHJ9qePz6lJHNjZvTwIVZDONxZ2J2n6UxyGYp07M52iMEIn6wAABgeW3ZPP5Z5VRLcTs/LikWVmGzO9XpmePtwCKqte+ujxobENd7G3cS1JJw+/8fJWjL82CQA9hfxQuVReI142NJrNA42k+emf/5UIXuRMn48Mj+DHX38EAOTj3Kr+3t4ntdYPMfMIEcF7nxlrdynCHmrUDlYbrUoLyHJAp1gq5sNy/7CIv8Y6dxsRhol4/0Jj4cX6wsL+RSX37wVkfHwcjz70MCq1KgDgiuUrbmXF9zLxg1rrUaKT6iJiRPyMeEmJSUGoQEzLvfeZde49Bm0/enxqF4BkcGAAs3Nz59ckCoUCkiTpitHlg8vXseL1IrgrDII7lFJXyanI9t4bY+24iOyEyMGpmROHAMwDQKlQxELSWHqrU0rB/RUQVCz0lAd6e29h5o9xkrTunHsqSdPx6nx9vlvrmRmnGsS57/7HBitnNpbMZO0gCA0rulkrtTIz5oNKrba1kTQr/3TubOClTg6z1cq09/59gACCYsV0IYPAkohzuRgAjLHuQ+vcvkAHG/tK5eELGX3UUpSttSiVSqjWanO5KJ4mwpj3bk8jSSYv9cy2IgzCoUAH6pKwdfP5dERBdElfzEucVP/Hfwh/ADLUZ+1J70yMAAAAAElFTkSuQmCC" />
        {% set icon_class %}{% spaceless %}
            {% if collector.queries|length > 0 %}
                {% if collector.errors|length > 0 %}
                    sf-toolbar-status-red
                {% else %}
                    sf-toolbar-status-green
                {% endif %}
            {% endif %}
        {% endspaceless %}{% endset %}
        <span class="sf-toolbar-status {{ icon_class }}">{{ collector.queries|length }}</span>
        {% if collector.queries|length > 0 %}
            <span class="sf-toolbar-info-piece-additional-detail">{{ '%0.2f'|format(collector.time * 1000) }} ms</span>
        {% endif %}
    {% endset %}

    {% set text %}
        <div class="sf-toolbar-info-piece">
            <b>Queries: </b>
            <span class="sf-toolbar-status">{{ collector.queries|length }}</span>
        </div>
        {% if collector.queries|length > 0 %}
            <div class="sf-toolbar-info-piece">
                <b>Execution time: </b>
                <span class="sf-toolbar-status">{{ collector.time|number_format(2) }} ms</span>
            </div>
            <div class="sf-toolbar-info-piece">
                <b>Errors: </b>
                <span class="sf-toolbar-status sf-toolbar-status-{% if collector.errors|length > 0 %}red{% else %}green{% endif %}">{{ collector.errors|length }}</span>
            </div>
        {% endif %}
    {% endset %}
    {% include 'WebProfilerBundle:Profiler:toolbar_item.html.twig' with { 'link': true } %}
{% endblock %}

{% block head %}
    {{ parent() }}
{% endblock %}

{% block menu %}
    <span class="label">
        <span class="icon"><img alt="Sphinx" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAcCAYAAAB2+A+pAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wITDhcW7BmzhgAABOVJREFUSMftVstrnFUU/51z7/eYmcxMHk2rxjbWpNJqrCBUxQdFUJAiKIgL3ys3+gdocVEQF4oLXRbdCKJoLWjFYny0KCrSQi2ltkgTX7VJGzOZmWTm+2bmu4/joh1tYytNKXWhv9V37j33/s4933kB/xLoIurKxSKmRd9yDgJaRE7nYwidRe6SyGmrfaVCsRxoXVTMOUU6JiY4scZ52zaZXWim6bzzvtI9wszkvT+nAQSATyPz3Y1QB1cWiz2jWgcjmvkGpfUoMV9OxCUijogIHt4CSOBlxphswlm7t2OyI7V6/RCAKgAopdg5J4sNoDMFGhro670xCsMxZnWzUmoMxMsYUiBmDe/gWgnEWZCcspEYFISgIPaidNM7O+O8+8ZYt3u2OrfLOzcNAFprstb+SU7L+vo2EauRQAerleLrtFbXEqgfQExEzMQQAry186o82MitXjekegfBuR4BiKTVFPP7UeocPUKuMQfoCOKsA2jeeLuv0+68NVuv7hDn6/k4RtpuAwB0FOeeiKPoPvGeiCjoeoGZYUx2POlkOz3wNVj/etUjzzxXHF1/JYWxUBiRgEiyNqTVoPSXH+aPbXv1TZqa2BTli1c7a8qh0nerPK9cJr3Ts9XqZ11SANDNZvPdOAzvB8ACOEDanSzbmabpO5m1hxg01TamM/bCuzp39bVDXOqF67SJrBEAEGbR/ZdRFOZ1q3/oi873e1/pAT2Wj+LNIFIQ5Im5tDi42Fm7o9FsbmFmLd4TBD0kUJkxe5MkmWgkzdSYjJhYfJY1xXlABER00jUiJM7Am7Y3UGkzMz+dmJl5frY6d6cx5lsSiryXbHFMqcwaaWWtvUopisJwIwRQWl0X6OCmOIy+S1utCgDPV6wW06yHpVWjm4gIEAGIiESEgpDqteoRXe7fXP/yfQDwWZYdy4wZB8EpxVNJmk6eHtnq+rVrMTNbcUmafhUGYTUI9I1E1BNoPayUeiCOoxNBEEzN7vk8yW95+4D9bWJNvlAcBavgVJJK2mr/PPHJ9qePz6lJHNjZvTwIVZDONxZ2J2n6UxyGYp07M52iMEIn6wAABgeW3ZPP5Z5VRLcTs/LikWVmGzO9XpmePtwCKqte+ujxobENd7G3cS1JJw+/8fJWjL82CQA9hfxQuVReI142NJrNA42k+emf/5UIXuRMn48Mj+DHX38EAOTj3Kr+3t4ntdYPMfMIEcF7nxlrdynCHmrUDlYbrUoLyHJAp1gq5sNy/7CIv8Y6dxsRhol4/0Jj4cX6wsL+RSX37wVkfHwcjz70MCq1KgDgiuUrbmXF9zLxg1rrUaKT6iJiRPyMeEmJSUGoQEzLvfeZde49Bm0/enxqF4BkcGAAs3Nz59ckCoUCkiTpitHlg8vXseL1IrgrDII7lFJXyanI9t4bY+24iOyEyMGpmROHAMwDQKlQxELSWHqrU0rB/RUQVCz0lAd6e29h5o9xkrTunHsqSdPx6nx9vlvrmRmnGsS57/7HBitnNpbMZO0gCA0rulkrtTIz5oNKrba1kTQr/3TubOClTg6z1cq09/59gACCYsV0IYPAkohzuRgAjLHuQ+vcvkAHG/tK5eELGX3UUpSttSiVSqjWanO5KJ4mwpj3bk8jSSYv9cy2IgzCoUAH6pKwdfP5dERBdElfzEucVP/Hfwh/ADLUZ+1J70yMAAAAAElFTkSuQmCC" /></span>
        <strong>Sphinx</strong>

        <span class="count">
            <span {% if collector.errors|length > 0 %}style="background-color: #a33;"{% endif %}>{{ collector.queries|length }}</span>
            {% if collector.queries|length > 0 %}
                <span>{{ '%0.0f'|format(collector.time * 1000) }} ms</span>
            {% endif %}
        </span>
    </span>
{% endblock %}

{% block panel %}

    {% if collector.queries|length > 0 %}
    <ul>
        {% for q in collector.queries %}
            <li>
                {{ q.sql }}
                <br>
                {{ q.time }}
            </li>
        {% endfor %}
    </ul>
    {% else %}
        <p>
            Запросов к сфинкс не было
        </p>
    {% endif %}

    {#
        //todo
        Выводим
        - ошибки если таковые были
        - все запросы по типам и подключениям (билдер или апи)
            - запрос
            - время
            - индекс
            - ошибка
        - все подключения со статой
    #}

{% endblock %}
